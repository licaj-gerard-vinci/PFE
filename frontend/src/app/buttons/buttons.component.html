<body class="body">
  <div class="share-button-container">
    <button class="share-button" (click)="copyLink()">Partager</button>
  </div>
  <div class="main-container">
    <div class="left">
      <img src="/logo.png" class="logo">
      <img (click)="openInfo1()" src="/information.png" class="info1">
      <img (click)="openInfo2()" src="/information.png" class="info2">
    <div *ngIf="enjeux.length >0;">
        <div *ngFor="let enjeu of sortedEnjeux; let i = index">
            <button class="button" (click)="sortQuestions(enjeu.id_enjeu)"><img [src]="selectedEnjeuId === enjeu.id_enjeu ? '/chevron-down.svg' : '/chevron-right.svg'" alt="icone" class="icon" />{{i+1}}. {{enjeu.nom}} <img *ngIf="hasAllResponses(enjeu.id_enjeu)" src="/check.png" alt="icon" class="check-icon"></button>
            <div class="questions-container" [class.active]="selectedEnjeuId === enjeu.id_enjeu">
                <div *ngFor="let question of sortedQuestions; let j = index"
                    [ngClass]="{'selected': question.id_question === selectedQuestionId}"
                    (click)="selectQuestion(question.id_question)">
                    <button class="button"><img *ngIf="(isAnswered(question.id_question) || !checkIfCanAnswer(question.id_question))" src="/check.png" class="check">{{i+1}}.{{j+1}} {{question.sujet}}</button>
                </div>
            </div>
        </div>
        <div *ngIf="checkEachEnjeux()">
            <button (click)="openModal()" class="button">{{sortedEnjeux.length+1}}. VALIDATION</button>
        </div>
        <div class="modal" *ngIf="showModal">
            <div class="modal-content">
              <p>Voulez-vous vraiment valider votre questionnaire ?</p>
              <button (click)="confirmValidation()">Oui</button>
              <button (click)="closeModal()">Non</button>
            </div>
        </div>
    </div>
  </div>
  <div class="right">

    <div class="progress-bar-container">
      <div class="progress-text">{{ getProgressPercentage() | number:'1.0-0' }}%</div>
      <div class="progress-bar">
        <div class="progress-bar-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
    </div>
  
<div class="form-container">
  
    <!-- Flèche gauche -->
    <button class="side-button left-button" (click)="previousQuestion()"><</button>
  
    <!-- Formulaire -->
    <form class="simple-form">
      <!-- Conteneur pour Aujourd'hui et Pacte d'engagement -->
      <div class="header-container">
        <div
          class="aujourdhui"
          [class.active]="activeTab === 'aujourdhui'"
          (click)="switchTab('aujourdhui')"
        >
          <p>AUJOURD'HUI</p>
        </div>
        <div
          class="engagement"
          [class.active]="activeTab === 'engagement'"
          (click)="switchTab('engagement')"
        >
          <p>PACTE D'ENGAGEMENT (DANS LES 2 ANS)</p>
        </div>
      </div>
  
      <!-- Numéro et Texte de la question dans un conteneur commun -->
      <div class="question-container">
        <div class="question-number">{{ currentQuestion.number }}</div>
        <div class="question-text">{{ currentQuestion.text }}</div>
      </div>
      <div *ngIf="getExistingAnswer(currentQuestion.id); else answerForm">
        <p>Réponse(s) :</p>
        <ul>
          <li *ngFor="let reponseClient of getClientAnswer(currentQuestion.id, activeTab)">
            - {{ reponseClient.texte }} {{reponseClient.rep_aujourd_hui}}{{reponseClient.rep_dans_2_ans}}
          </li>
        </ul>
      </div>
    
      <ng-template #answerForm>
      <div class="question-options">
        <!-- Type Radio -->
        <ul *ngIf="currentQuestion?.type === 'radio'">
          <li *ngFor="let reponse of currentQuestion.reponses">
            <label  *ngIf="checkTemplatesReponses(reponse) ; else elseBlock">
              <input 
                type="radio"
                [value]="reponse.text"
                [checked]="activeTab === 'aujourdhui' ? responses.aujourdhui === reponse.text : responses.engagement === reponse.text" 
                name="answer"
                (change)="onReponseSelected(reponse)"
              />
              {{ reponse.text }}
            </label>
            <ng-template #elseBlock>
              <img src="/croixRouge.png" class="croixRouge">{{ reponse.text }}
            </ng-template>
          </li>
        </ul>
  
        <!-- Type Checkbox -->
        <ul *ngIf="currentQuestion?.type === 'checkbox'">
          <li *ngFor="let reponse of currentQuestion.reponses">
            <label *ngIf="checkTemplatesReponses(reponse); else elseBlock1">
              <input
                type="checkbox"
                [value]="reponse.text" 
                [checked]="activeTab === 'aujourdhui' ? getText(selectedCheckboxeAujourdhui,reponse.text) : getText(selectedCheckboxeEngagement,reponse.text)" 
                (change)="onCheckboxChange($event, reponse)"
              />
              {{ reponse.text }}
            </label>
            <ng-template #elseBlock1>
              <img src="/croixRouge.png" class="croixRouge">{{ reponse.text }}
            </ng-template>
          </li>
        </ul>
  
        <!-- Type Libre -->
        <div *ngIf="currentQuestion?.type === 'libre'">
          <textarea
            placeholder="Votre réponse (max 50000 caractères)..."
            [value]="activeTab === 'aujourdhui' ? champLibreAujourdhui : champLibreEngagement"
            (input)="onChampInput($event)"
          ></textarea>
        </div>
      </div>
    </ng-template>
    <div class="comment-section">
      <button *ngIf="checkIfCanAnswer(currentQuestion.id)" class="addComment" type="button" (click)="toggleCommentField()">+</button>
      <div *ngIf="showCommentField" class="comment-field">
        <textarea
          placeholder="Votre réponse (max 50000 caractères)..."
          (input)="onCommentInput($event)"
        ></textarea>
      </div>
    </div>
  <div *ngIf="checkIfCanAnswer(currentQuestion.id)">
    <button type="button" class="confirm-button" (click)="confirmAnswer()">CONFIRMER</button>
  </div>
    </form>
    <button class="side-button right-button" (click)="nextQuestion()">></button>
  </div>
  
</div>
</div>
</body>


<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Frontend</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script>
    // Fonction pour vérifier l'état de connexion et gérer le bouton
    function updateLoginButton() {
      const isLoggedIn = window.isLoggedIn && window.isLoggedIn(); // Appelle la méthode Angular
      const currentPath = window.location.pathname; // Récupère la route active

      // Si on est sur la page login, on cache le bouton
      if (currentPath === '/login') {
        const button = document.getElementById('auth-button');
        if (button) {
          button.style.display = 'none'; // Cache le bouton
        }
        return;
      }

      // Sélectionnez ou créez dynamiquement le bouton
      let button = document.getElementById('auth-button');
      if (!button) {
        button = document.createElement('a');
        button.id = 'auth-button';
        button.className = 'auth-button';
        button.style.position = 'fixed';
        button.style.top = '10px';
        button.style.right = '20px';
        button.style.padding = '10px 15px';
        button.style.backgroundColor = '#013238';
        button.style.color = '#fff';
        button.style.borderRadius = '5px';
        button.style.textDecoration = 'none';
        button.style.cursor = 'pointer';
        button.style.fontWeight = 'bold';
        button.style.transition = 'background-color 0.3s ease';
        document.body.appendChild(button);
      }

      // Mettez à jour le texte et les actions du bouton
      if (isLoggedIn) {
        button.textContent = 'Se déconnecter';
        button.onclick = () => window.logout && window.logout(); // Déconnexion
        button.href = 'javascript:void(0);'; // Désactive la navigation
        button.style.display = 'block'; // Affiche le bouton
      } else {
        button.textContent = 'Se connecter';
        button.href = '/login'; // Redirige vers la page de connexion
        button.onclick = null; // Supprime tout gestionnaire d'événements
        button.style.display = 'block'; // Affiche le bouton
      }
    }

    // Vérifiez si Angular est prêt avant d'appeler updateLoginButton
    function waitForAngular() {
      if (window.isLoggedIn) {
        updateLoginButton(); // Appelle la mise à jour lorsque Angular est prêt
      } else {
        setTimeout(waitForAngular, 100); // Réessaye après 100 ms
      }
    }

    // Appelle la fonction après le chargement de la page
    document.addEventListener('DOMContentLoaded', waitForAngular);
  </script>
</head>
<body class="mat-typography">
  <app-root></app-root>
</body>
</html>
